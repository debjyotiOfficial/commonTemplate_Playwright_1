================================================================================
CHANGES LOG - cypress-to-playwright-converted
================================================================================
This file documents all changes made to test files and config files.
Use this to revert changes if BrowserStack builds fail.
================================================================================

================================================================================
DATE: 2025-12-03
================================================================================

--------------------------------------------------------------------------------
FILE: tests/TS052_getSupport.spec.js
--------------------------------------------------------------------------------

CHANGE 1: Replaced manual login with fast login helper
-------------------------------------------------------
Lines affected: 27-41 (original) → 27-28 (new)

ORIGINAL CODE:
```javascript
await page.goto(config.urls.backAdminLoginPage);

await expect(page.locator(config.selectors.login.usernameFieldBackup)).toBeVisible();
await page.locator(config.selectors.login.usernameFieldBackup).clear();
await page.locator(config.selectors.login.usernameFieldBackup).fill(config.credentials.demo.usernameBackup);

await expect(page.locator(config.selectors.login.passwordFieldBackup)).toBeVisible();
await page.locator(config.selectors.login.passwordFieldBackup).clear();
await page.locator(config.selectors.login.passwordFieldBackup).fill(config.credentials.demo.passwordBackup);

await expect(page.locator(config.selectors.login.submitButtonBackup)).toBeVisible();
await page.locator(config.selectors.login.submitButtonBackup).click();

await page.waitForTimeout(config.timeouts.wait);
await page.goto(config.urls.fleetDashboard3);
```

NEW CODE:
```javascript
// Use fast login helper which handles stored auth vs fresh login automatically
await helpers.loginAndNavigateToPage(config.urls.fleetDashboard3);
```

REASON: Original code used page.waitForTimeout(config.timeouts.wait) which is a
fixed 60 second wait. The loginAndNavigateToPage() helper uses
waitForLoadState('networkidle') which is much faster.


CHANGE 2: Simplified Get Support navigation
-------------------------------------------
Lines affected: 43-50 (after change 1) → 43-44

ORIGINAL CODE:
```javascript
// Navigate to Get Support
// First, expand the accordion by clicking on the header
const accordionHeader = page.locator('.accordion__header__label2').filter({ hasText: 'fleetdemo' });
await accordionHeader.click({ force: true });
await page.waitForTimeout(500); // Wait for accordion to expand

// Then click Get Support
await page.locator(config.selectors.getSupport.getSupportMenu).click({ force: true });
```

NEW CODE:
```javascript
// Navigate to Get Support - click directly on the visible menu item
await page.locator('text=Get Support').first().click({ force: true });
```

REASON: The accordion header '.accordion__header__label2' was not visible on the
page. Page snapshot showed "Get Support" is already visible directly in the
navigation menu (no accordion expansion needed).


CHANGE 3: Added force click to submit button
--------------------------------------------
Line affected: 81

ORIGINAL CODE:
```javascript
await submitButton.click();
```

NEW CODE:
```javascript
await submitButton.click({ force: true });
```

REASON: Submit button was outside the viewport causing timeout error.


--------------------------------------------------------------------------------
FILE: fixtures/tlr-config.json
--------------------------------------------------------------------------------

CHANGE 1: Updated getSupportMenu selector
-----------------------------------------
Line affected: 232

ORIGINAL CODE:
```json
"getSupportMenu": "#bottom-nav-support",
```

NEW CODE:
```json
"getSupportMenu": "#bottom-nav-support1",
```

REASON: The actual element ID in the HTML is "#bottom-nav-support1" (with "1"
suffix), not "#bottom-nav-support". This was causing element not found errors.


================================================================================
HOW TO REVERT ALL CHANGES
================================================================================

TO REVERT TS052_getSupport.spec.js:
-----------------------------------
Replace lines 23-31 with:

```javascript
test('should verify Get Support and Insurance form functionality', async ({ page }) => {
    const helpers = new TestHelpers(page);
    config = await helpers.getConfig();

    await page.goto(config.urls.backAdminLoginPage);

    await expect(page.locator(config.selectors.login.usernameFieldBackup)).toBeVisible();
    await page.locator(config.selectors.login.usernameFieldBackup).clear();
    await page.locator(config.selectors.login.usernameFieldBackup).fill(config.credentials.demo.usernameBackup);

    await expect(page.locator(config.selectors.login.passwordFieldBackup)).toBeVisible();
    await page.locator(config.selectors.login.passwordFieldBackup).clear();
    await page.locator(config.selectors.login.passwordFieldBackup).fill(config.credentials.demo.passwordBackup);

    await expect(page.locator(config.selectors.login.submitButtonBackup)).toBeVisible();
    await page.locator(config.selectors.login.submitButtonBackup).click();

    await page.waitForTimeout(config.timeouts.wait);
    await page.goto(config.urls.fleetDashboard3);

    // Navigate to Get Support
    await page.locator(config.selectors.getSupport.getSupportMenu).hover();
    await page.waitForTimeout(500);

    await expect(page.locator(config.selectors.getSupport.getSupportMenu)).toBeVisible();
    await page.locator(config.selectors.getSupport.getSupportMenu).click();
```

And change line ~87 from:
  await submitButton.click({ force: true });
back to:
  await submitButton.click();


TO REVERT tlr-config.json:
--------------------------
Change line 232 from:
  "getSupportMenu": "#bottom-nav-support1",
back to:
  "getSupportMenu": "#bottom-nav-support",


--------------------------------------------------------------------------------
FILE: tests/TS055_appearanceSettings.spec.js
--------------------------------------------------------------------------------

CHANGE 1: Fixed Reset button selector to avoid strict mode violation
---------------------------------------------------------------------
Line affected: 385

ORIGINAL CODE:
```javascript
const resetButton = page.locator('button:has-text("Reset to default")');
```

NEW CODE:
```javascript
const resetButton = page.locator('button.appearance-modal__reset-btn');
```

REASON: The original selector matched 2 buttons on the page:
1. <button class="appearance-modal__reset-btn reset-to-default">Reset to default</button>
2. <button id="resetSettings" class="btn btn-secondary">Reset to Defaults</button>

Using the specific class selector targets only the button inside the Appearance
Settings modal.


TO REVERT TS055_appearanceSettings.spec.js:
-------------------------------------------
Change line 385 from:
  const resetButton = page.locator('button.appearance-modal__reset-btn');
back to:
  const resetButton = page.locator('button:has-text("Reset to default")');


================================================================================
BULK CHANGE: Replaced manual login with loginAndNavigateToPage() helper
================================================================================
DATE: 2025-12-03

All test files below were updated to replace the manual login pattern with the
fast login helper loginAndNavigateToPage(). This change:
- Reduces login time from 60+ seconds (fixed waitForTimeout) to ~3 seconds (networkidle)
- Makes tests run significantly faster
- Centralizes login logic in the TestHelpers class

--------------------------------------------------------------------------------
ORIGINAL CODE PATTERN (in all files):
--------------------------------------------------------------------------------
```javascript
await page.goto(config.urls.backAdminLoginPage);
// or config.urls.backupLoginPage

await expect(page.locator(config.selectors.login.usernameFieldBackup)).toBeVisible();
await page.locator(config.selectors.login.usernameFieldBackup).clear();
await page.locator(config.selectors.login.usernameFieldBackup).fill(config.credentials.demo.usernameBackup);

await expect(page.locator(config.selectors.login.passwordFieldBackup)).toBeVisible();
await page.locator(config.selectors.login.passwordFieldBackup).clear();
await page.locator(config.selectors.login.passwordFieldBackup).fill(config.credentials.demo.passwordBackup);

await expect(page.locator(config.selectors.login.submitButtonBackup)).toBeVisible();
await page.locator(config.selectors.login.submitButtonBackup).click();

await page.waitForTimeout(config.timeouts.wait);
await page.goto(config.urls.fleetDashboard3);
// or config.urls.fleetNewDashboard, config.urls.fleetDashcamDashboard2
```

--------------------------------------------------------------------------------
NEW CODE PATTERN (in all files):
--------------------------------------------------------------------------------
```javascript
// Use fast login helper which handles stored auth vs fresh login automatically
await helpers.loginAndNavigateToPage(config.urls.fleetDashboard3);
// URL varies by test: fleetDashboard3, fleetNewDashboard, fleetDashcamDashboard2
```

--------------------------------------------------------------------------------
FILES UPDATED (44 test files):
--------------------------------------------------------------------------------

tests/TS003_ChangeTimezone.spec.js         -> config.urls.fleetDashboard3
tests/TS004_viewEditUser.spec.js           -> config.urls.fleetDashboard3
tests/TS005_subgroup.spec.js               -> config.urls.fleetDashboard3
tests/TS006_trackInfoDisplayOptions.spec.js -> config.urls.fleetDashboard3
tests/TS007_pulsingIcon.spec.js            -> config.urls.fleetDashboard3
tests/TS008_alertsContact.spec.js          -> config.urls.fleetDashboard3
tests/TS009_changeAlertSettings.spec.js    -> config.urls.fleetDashboard3
tests/TS010_scheduledReports.spec.js       -> config.urls.fleetDashboard3
tests/TS011_addEditMaintenanceContact.spec.js -> config.urls.fleetDashboard3
tests/TS012_maintainanceReport.spec.js     -> config.urls.fleetDashboard3
tests/TS013_viewVehicleService.spec.js     -> config.urls.fleetDashboard3
tests/TS014_weeklyAfterHoursSummary.spec.js -> config.urls.fleetDashboard3
tests/TS015_afterHourSummary.spec.js       -> config.urls.fleetDashboard3
tests/TS016_afterHoursInsight.spec.js      -> config.urls.fleetNewDashboard
tests/TS017_afterHoursSettings.spec.js     -> config.urls.fleetNewDashboard
tests/TS018_createGeofencing.spec.js       -> config.urls.fleetDashboard3
tests/TS019_viewDeleteGeofence.spec.js     -> config.urls.fleetDashboard3
tests/TS020_weeklyGeofenceReport.spec.js   -> config.urls.fleetDashboard3
tests/TS021_currentGeofenceReport.spec.js  -> config.urls.fleetDashboard3
tests/TS022_recentGeofenceReport.spec.js   -> config.urls.fleetDashboard3
tests/TS023_changePassword.spec.js         -> config.urls.fleetDashboard3
tests/TS024_createLandmark.spec.js         -> config.urls.fleetDashboard3
tests/TS025_landmarkReport.spec.js         -> config.urls.fleetDashboard3
tests/TS026_viewEditLandmark.spec.js       -> config.urls.fleetDashboard3
tests/TS027_trackHistory.spec.js           -> config.urls.fleetDashboard3
tests/TS028_travelLogReport.spec.js        -> config.urls.fleetDashboard3
tests/TS029_currentLocationReport.spec.js  -> config.urls.fleetDashboard3
tests/TS030_mileageReport.spec.js          -> config.urls.fleetDashboard3
tests/TS031_stateMileageReport.spec.js     -> config.urls.fleetDashboard3
tests/TS032_30DayMileageReport.spec.js     -> config.urls.fleetDashboard3
tests/TS033_postedSpeedReport.spec.js      -> config.urls.fleetDashboard3
tests/TS034_tripReport.spec.js             -> config.urls.fleetDashboard3
tests/TS035_engineOnReport.spec.js         -> config.urls.fleetDashboard3
tests/TS036_idlingReport.spec.js           -> config.urls.fleetDashboard3
tests/TS037_lowVoltageDeviceReport.spec.js -> config.urls.fleetDashboard3
tests/TS038_driverSafetyReport.spec.js     -> config.urls.fleetDashboard3
tests/TS039_weeklyUtilizationReport.spec.js -> config.urls.fleetDashboard3
tests/TS040_ExitReport.spec.js             -> config.urls.fleetDashboard3
tests/TS041_UtilizationReport.spec.js      -> config.urls.fleetDashboard3
tests/TS042_dayOfWeekReport.spec.js        -> config.urls.fleetDashboard3
tests/TS043_dashcamRefresh.spec.js         -> config.urls.fleetDashcamDashboard2
tests/TS044_snapshots.spec.js              -> config.urls.fleetDashcamDashboard2
tests/TS045_dashcamAlertReport.spec.js     -> config.urls.fleetDashcamDashboard2
tests/TS046_dashcamTrackHistory.spec.js    -> config.urls.fleetDashcamDashboard2
tests/TS047_dashcamAlertSettings.spec.js   -> config.urls.fleetDashcamDashboard2
tests/TS048_dashcamVideoOnDemand.spec.js   -> config.urls.fleetDashcamDashboard2
tests/TS049_liveVideoStream.spec.js        -> config.urls.fleetDashcamDashboard2
tests/TS050_last24hrs.spec.js              -> config.urls.fleetDashboard3
tests/TS051_realTimeTracking.spec.js       -> config.urls.fleetDashboard3
tests/TS052_getSupport.spec.js             -> config.urls.fleetDashboard3
tests/TS053_travelLogReport_footer.spec.js -> config.urls.fleetDashboard3
tests/TS054_subgroup_footer.spec.js        -> config.urls.fleetDashboard3
tests/TS055_appearanceSettings.spec.js     -> config.urls.fleetDashboard3
tests/TS056_instantGeofence.spec.js        -> config.urls.fleetDashboard3
tests/viewEditUser.spec.js                 -> config.urls.fleetDashboard3

--------------------------------------------------------------------------------
FILES NOT CHANGED (already using helper or different login method):
--------------------------------------------------------------------------------
tests/TS001_listOfDevice.spec.js    - Uses helpers.login() method
tests/TS002_addEditDevices.spec.js  - Already uses loginAndNavigateToPage()
tests/TS057_accountHealthSummary.spec.js - Already uses loginAndNavigateToPage()

================================================================================
HOW TO REVERT ALL loginAndNavigateToPage() CHANGES
================================================================================

To revert any file back to manual login, replace:

```javascript
// Use fast login helper which handles stored auth vs fresh login automatically
await helpers.loginAndNavigateToPage(config.urls.fleetDashboard3);
```

With the original manual login code:

```javascript
await page.goto(config.urls.backAdminLoginPage);

await expect(page.locator(config.selectors.login.usernameFieldBackup)).toBeVisible();
await page.locator(config.selectors.login.usernameFieldBackup).clear();
await page.locator(config.selectors.login.usernameFieldBackup).fill(config.credentials.demo.usernameBackup);

await expect(page.locator(config.selectors.login.passwordFieldBackup)).toBeVisible();
await page.locator(config.selectors.login.passwordFieldBackup).clear();
await page.locator(config.selectors.login.passwordFieldBackup).fill(config.credentials.demo.passwordBackup);

await expect(page.locator(config.selectors.login.submitButtonBackup)).toBeVisible();
await page.locator(config.selectors.login.submitButtonBackup).click();

await page.waitForTimeout(config.timeouts.wait);
await page.goto(config.urls.fleetDashboard3);
```

Note: Adjust the URL (fleetDashboard3, fleetNewDashboard, fleetDashcamDashboard2)
based on which file you're reverting. See the file list above for the correct URL.

================================================================================
FILE: tests/TS051_realTimeTracking.spec.js - COMPLETE RESTRUCTURE
================================================================================
DATE: 2025-12-03

CHANGE: Completely restructured test to fix hidden element issue
---------------------------------------------------------------

REASON: Original test failed with TimeoutError because it tried to hover on
'#bottom-nav-realtime' which exists in DOM but is not visible on the page.

ORIGINAL CODE (133 lines - REMOVED):
```javascript
test('should verify Tracker Display Options and Engine Idling Events functionality', async ({ page }) => {
    const helpers = new TestHelpers(page);
    config = await helpers.getConfig();

    await helpers.loginAndNavigateToPage(config.urls.fleetDashboard3);

    // Navigate to Real Time Tracking
    await page.locator(config.selectors.realTimeTracking.realTimeTrackingMenu).hover();
    await page.waitForTimeout(500);

    await expect(page.locator(config.selectors.realTimeTracking.realTimeTrackingMenu)).toBeVisible();
    await page.locator(config.selectors.realTimeTracking.realTimeTrackingMenu).click();

    // Navigate to the specific real-time tracking page
    await page.goto('https://www.gpsandfleet-server1.com/gpsandfleet/client/varsha_dashcamdemo/maps/index2_here_new_realtime_tracking.php');

    // Wait for page to load completely
    await page.waitForLoadState('networkidle');
    await page.waitForTimeout(3000);

    // Test Tracker Display Options functionality
    console.log('Testing Tracker Display Options...');

    // Hover on Tracker Display Options
    const trackerDisplayOptions = page.locator('text=Tracker Display Options');
    await expect(trackerDisplayOptions).toBeVisible();
    await trackerDisplayOptions.hover();
    // ... rest of original code tested Standard/Name Only display options
    // ... and Engine Idling Events checkbox functionality
});
```

NEW CODE (94 lines - RESTRUCTURED):
```javascript
test('should verify real-time tracking timer and API data synchronization', async ({ page }) => {
    const helpers = new TestHelpers(page);
    config = await helpers.getConfig();

    await helpers.loginAndNavigateToPage(config.urls.fleetDashboard3);

    // Step 1: Verify Driver Card container is visible
    const driverCardContainer = page.locator('.driver-card__container');
    await expect(driverCardContainer.first()).toBeVisible({ timeout: 15000 });

    // Step 2: Click on Demo 1 driver card
    const demo1Card = page.locator('.driver-card__container').filter({ hasText: 'Demo 1' });
    await demo1Card.click();

    // Step 3: Verify realtime tracking timer is visible with driver name
    const realtimeTimer = page.locator('#realtime-tracking-timer');
    await expect(realtimeTimer).toBeVisible({ timeout: 10000 });
    const vehicleName = page.locator('#realtime-tracking-vehicle-name');
    await expect(vehicleName).toContainText('Demo 1');

    // Step 4: Set up API response listener before the 30-second refresh
    const apiResponsePromise = page.waitForResponse(
        response => response.url().includes('getVehiclesInfo_track_test.php') &&
                    response.url().includes('vehicleId=15') &&
                    response.status() === 200,
        { timeout: 35000 }
    );

    // Step 5: Wait for timer to reset (30 seconds) and capture API response
    const apiResponse = await apiResponsePromise;
    const responseData = await apiResponse.json();

    // Step 6: Verify API data matches Driver Card UI
    const driverCard = page.locator('#driver-card-15');
    await expect(driverCard).toBeVisible();

    // Verify mileage, address, speed from API matches UI
    // ... data verification logic
});
```

NEW TEST FLOW:
1. Login and navigate to fleetDashboard3
2. Verify driver card container is visible
3. Click on "Demo 1" driver card
4. Verify realtime tracking timer (#realtime-tracking-timer) appears with driver name
5. Wait for 30-second timer cycle (00:00 to 00:30)
6. Capture API response from getVehiclesInfo_track_test.php?vehicleId=15
7. Verify API data (mileage, address, speed) matches driver card UI

--------------------------------------------------------------------------------
TO REVERT TS051_realTimeTracking.spec.js:
--------------------------------------------------------------------------------
Replace the entire test file content with the original code that:
- Navigates to Real Time Tracking via #bottom-nav-realtime menu
- Tests Tracker Display Options (Standard/Name Only)
- Tests Engine Idling Events checkbox functionality

Note: The original test flow relies on #bottom-nav-realtime being visible,
which it currently is not. The element exists but is hidden.

================================================================================
END OF CHANGES LOG
================================================================================

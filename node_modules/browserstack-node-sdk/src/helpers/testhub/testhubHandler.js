const a130_0x563604=a130_0x16ef;(function(_0x2d2b4f,_0x1ccce9){const _0x430237=a130_0x16ef,_0x50797f=_0x2d2b4f();while(!![]){try{const _0x218476=parseInt(_0x430237(0xcb))/0x1*(-parseInt(_0x430237(0xdb))/0x2)+-parseInt(_0x430237(0xf0))/0x3+parseInt(_0x430237(0x90))/0x4+parseInt(_0x430237(0xf9))/0x5+-parseInt(_0x430237(0x95))/0x6*(-parseInt(_0x430237(0xf3))/0x7)+-parseInt(_0x430237(0xb6))/0x8*(-parseInt(_0x430237(0x8d))/0x9)+parseInt(_0x430237(0xa1))/0xa*(-parseInt(_0x430237(0xe3))/0xb);if(_0x218476===_0x1ccce9)break;else _0x50797f['push'](_0x50797f['shift']());}catch(_0x33b8fa){_0x50797f['push'](_0x50797f['shift']());}}}(a130_0x572e,0x1e14c));function a130_0x572e(){const _0x27d2e8=['../../bin/v2/browserstackCLI','toISOString','cwd','buildStopSent','waitForBuildStatus','./utils.js','env','ACCESSIBILITY','basename','success','16809DfMpgF','config','exports','7hExGfq','authToken','getAccessibilityOptions','accessibilityOptions','data','getCiInfo','1033655soaNke','path','processTraceZips','../performance/performance-tester.js','HJUNU','eBMEd','../logger','response','../test-observability/utils','BtdBZ','POST','stop','BROWSERSTACK_BUILD_RUN_IDENTIFIER','getTestOrchestrationBuildStartData','All\x20trace\x20zip\x20send\x20events\x20complete','../test-observability/requestQueueHandler.js','../performance/constants','stopBuildUpstream\x20event\x20successful!','BROWSERSTACK_TEST_ACCESSIBILITY_SCRIPT_TIMEOUT','true','lcnc','util','false','PUT','getCentralUser','STOP','isUndefined','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','VibrB','status','PvbkY','ENV_VAR','../helper','dhutq','includes','207hmBVrx','SUXig','getFrameworkDetails','695064aNWDzA','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','accessibility','BROWSERSTACK_TEST_ACCESSIBILITY_PLATFORM','getHostInfo','1395210PWlAwM','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','statusText','BROWSERSTACK_TESTHUB_UUID','../../bin/utils/constants.js','error','allSettled','wOIkE','zNodF','measureWrapper','DSmZI','NFOPi','4170330lHBixj','TESTHUB_BUILD_API','Generating\x20build\x20upstream\x20data\x20for\x20TestHub','setTestObservabilityVariables','getTraceFilePaths','info','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','getProductMap','BROWSERSTACK_BUILD_GROUPING_IDENTIFIER','../test-observability/sessionHandler.js','OBSERVABILITY','checkAndSetupPercy','getUserName','getGitMetaData','LMLss','FTAnk','BROWSERSTACK_CENTRAL_SCANNER_JWT','message','settings','../../bin/playwright/reporter/test-details.js','auth','21176kmRFhk','percy','ctpMW','getAccessKey','central_scanner','setTestHubCommonMetaInfo','isBrowserstackInfra','BROWSERSTACK_TESTHUB_JWT','buildHashedId','debug','Percy\x20is\x20not\x20supported\x20for\x20','\x20framework','stringify','WPdnE','xbnVm','/stop','logBuildError','Error\x20while\x20waiting\x20for\x20events:\x20','assign','START','setAccessibilityVariables','25613OyzXeo','getInstance','resolve','BROWSERSTACK_ACCESSIBILITY','isAccessibilityEnabled','launchBuild','BROWSERSTACK_TEST_OBSERVABILITY','dvfSm','getAccessibilityValueFromYml','WLdwu','buildIdentifier','uHaPI','generateBuildUpstreamData','./constants.js','job_id','HPoUH','10FNMRaV','framework','gaqSX','WpLjm','token','MlaKc','BS_TESTOPS_BUILD_COMPLETED','buildName','11MNHFRU','getConfig','scannerProcessingTimeout'];a130_0x572e=function(){return _0x27d2e8;};return a130_0x572e();}const bsSetupHelper=require(a130_0x563604(0x8a)),path=require(a130_0x563604(0xfa)),util=require(a130_0x563604(0x10e)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a130_0x563604(0x101)),testhubUtils=require(a130_0x563604(0xeb)),testHubConstants=require(a130_0x563604(0xd8)),constants=require(a130_0x563604(0x99)),RequestQueueHandler=require(a130_0x563604(0x108)),logger=require(a130_0x563604(0xff))['winstonLogger'],SessionHandler=require(a130_0x563604(0xaa)),PerformanceTester=require(a130_0x563604(0xfc)),{TESTHUB_EVENTS:PerformanceEvents}=require(a130_0x563604(0x109)),TestDetails=require(a130_0x563604(0xb4)),{uploadTraceZip}=require('../../bin/playwright/reporter/pwUtils.js'),{isTurboScaleSession}=require('../helper.js'),BrowserstackCLI=require(a130_0x563604(0xe6)),OngoingEvents=new Set();function a130_0x16ef(_0x4ecb7e,_0x658dde){const _0x572ebe=a130_0x572e();return a130_0x16ef=function(_0x16ef92,_0x582b8e){_0x16ef92=_0x16ef92-0x84;let _0xc4e24a=_0x572ebe[_0x16ef92];return _0xc4e24a;},a130_0x16ef(_0x4ecb7e,_0x658dde);}let processedTraceZips=![];const addEvent=_0x1fb144=>{OngoingEvents['add'](_0x1fb144);},awaitAllEvents=async()=>{const _0x54eadf=a130_0x563604;return Promise[_0x54eadf(0x9b)](OngoingEvents);};class TestHubHandler{static [a130_0x563604(0xe9)]=![];static async[a130_0x563604(0xd0)](_0x3f4471,_0x11b720){const _0x1ec800=a130_0x563604,_0x2f6508={'wqzBa':function(_0x9f1541,_0x3bd720){return _0x9f1541||_0x3bd720;},'nBLaQ':function(_0x3660b0,_0x157da3){return _0x3660b0||_0x157da3;},'xbnVm':function(_0x50c507,_0x2260f1){return _0x50c507===_0x2260f1;},'HJUNU':function(_0x176a57){return _0x176a57();},'DSmZI':_0x1ec800(0x91),'SoJCB':'false','sYUKt':_0x1ec800(0xa7),'MlaKc':function(_0x48178b,_0x3bc89c,_0x36ac90,_0x16d08e,_0x60dffc){return _0x48178b(_0x3bc89c,_0x36ac90,_0x16d08e,_0x60dffc);},'sQScT':_0x1ec800(0x103),'dhutq':_0x1ec800(0x92),'NFOPi':_0x1ec800(0x10c),'ctpMW':_0x1ec800(0xe5),'WPdnE':function(_0x5d028c,_0x255fca){return _0x5d028c===_0x255fca;}};await PerformanceTester[_0x1ec800(0x9e)](PerformanceEvents[_0x1ec800(0xc9)],async()=>{const _0x2b8647=_0x1ec800,_0x4a1aef=Object[_0x2b8647(0xc8)]({},_0x11b720['config'],{'root_dir_path':'','framework':_0x11b720[_0x2b8647(0xdc)]}),_0x2ca59e=bsSetupHelper[_0x2b8647(0xad)](_0x4a1aef),_0x5b25e4=bsSetupHelper[_0x2b8647(0xb9)](_0x4a1aef),_0x292b95=_0x2f6508['wqzBa'](_0x2ca59e,'')+':'+_0x2f6508['nBLaQ'](_0x5b25e4,''),_0x5857da=testhubUtils[_0x2b8647(0xa8)](_0x4a1aef);process[_0x2b8647(0xec)]['BROWSERSTACK_PRODUCT_MAP']=JSON['stringify'](_0x5857da);if(_0x2f6508[_0x2b8647(0xc4)](_0x292b95,':'))return _0x2f6508[_0x2b8647(0xfd)](isTestObservabilitySession)&&(logger[_0x2b8647(0xbf)](_0x2f6508[_0x2b8647(0x9f)]),process[_0x2b8647(0xec)][_0x2b8647(0xe1)]=_0x2f6508['SoJCB']),testhubUtils[_0x2b8647(0xcf)](_0x4a1aef)&&logger['debug'](_0x2f6508['sYUKt']),[null,null];try{const _0x566010=await this[_0x2b8647(0xd7)](_0x4a1aef,_0x3f4471),_0x15341d=this[_0x2b8647(0xe4)](_0x2ca59e,_0x5b25e4),_0x53f552=await _0x2f6508[_0x2b8647(0xe0)](nodeRequest,_0x2f6508['sQScT'],testHubConstants[_0x2b8647(0xa2)],_0x566010,_0x15341d),_0x2d444f=this['extractDataFromResponse'](_0x4a1aef,_0x53f552,_0x15341d);await this[_0x2b8647(0xac)](_0x11b720,_0x3f4471);if(_0x2f6508[_0x2b8647(0xc4)](testhubUtils[_0x2b8647(0xd3)](_0x11b720[_0x2b8647(0xf1)]),null)){const _0x4e91cc=_0x2d444f[_0x2f6508[_0x2b8647(0x8b)]];_0x4e91cc&&_0x4e91cc[_0x2b8647(0xf4)]&&_0x4e91cc[_0x2b8647(0xbe)]&&(_0x11b720[_0x2b8647(0xf1)][_0x2b8647(0x92)]=!![],process[_0x2b8647(0xec)][_0x2b8647(0x93)]=_0x2f6508[_0x2b8647(0xa0)]);}return _0x2d444f&&_0x2d444f[_0x2f6508[_0x2b8647(0x8b)]]&&_0x2d444f[_0x2f6508['dhutq']][_0x2f6508[_0x2b8647(0xb8)]]&&(process[_0x2b8647(0xec)][_0x2b8647(0x10b)]=_0x2d444f[_0x2f6508['dhutq']][_0x2f6508['ctpMW']]),_0x2d444f;}catch(_0x22f75c){if(_0x2f6508[_0x2b8647(0xc3)](_0x22f75c[_0x2b8647(0xef)],![])){testhubUtils[_0x2b8647(0xc6)](_0x22f75c);return;}}})();}static async[a130_0x563604(0xfb)](){const _0x22e896=a130_0x563604,_0x2d1e76={'FCfcu':function(_0x595f9d,_0xae0b1,_0x225551){return _0x595f9d(_0xae0b1,_0x225551);},'VOsti':function(_0x416400,_0x35e2f8){return _0x416400(_0x35e2f8);},'BtdBZ':function(_0x543911){return _0x543911();},'AUdOr':_0x22e896(0x107)};if(processedTraceZips)return;const _0x59459a=TestDetails[_0x22e896(0xa5)]();_0x59459a['forEach'](({testUId:_0x25bf12,filePath:_0x4e943c})=>{var _0x5c1f50=_0x2d1e76['FCfcu'](uploadTraceZip,_0x4e943c,_0x25bf12);_0x2d1e76['VOsti'](addEvent,_0x5c1f50);});try{await _0x2d1e76[_0x22e896(0x102)](awaitAllEvents),logger[_0x22e896(0xbf)](_0x2d1e76['AUdOr']),processedTraceZips=!![];}catch(_0x480f92){logger[_0x22e896(0x9a)](_0x22e896(0xc7)+util['format'](_0x480f92));}}static async[a130_0x563604(0xac)](_0x58edbb,_0x48f467){const _0x5296f6=a130_0x563604;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x5296f6(0x8c)](_0x48f467)){await _0x58edbb['setupPercy']();return;}_0x58edbb['config'][_0x5296f6(0xb7)]&&logger[_0x5296f6(0xbf)](_0x5296f6(0xc0)+_0x48f467+_0x5296f6(0xc1));}static['getAccessibilityOptions'](_0x3da8ae){const _0x3b45d6=a130_0x563604,_0x5c6941={'SBTdo':function(_0x41c45a,_0x506a00){return _0x41c45a(_0x506a00);},'gaqSX':_0x3b45d6(0x10c)};let _0x50c7b7;if(_0x3da8ae[_0x3b45d6(0xf6)]){const _0x4f3582={};_0x4f3582[_0x3b45d6(0xb3)]=_0x3da8ae[_0x3b45d6(0xf6)],_0x50c7b7=_0x4f3582;}else{const _0x1f05c5={};_0x1f05c5[_0x3b45d6(0xb3)]={},_0x50c7b7=_0x1f05c5;}if((!bsSetupHelper[_0x3b45d6(0xbc)]()||_0x5c6941['SBTdo'](isTurboScaleSession,_0x3da8ae))&&testhubUtils[_0x3b45d6(0xcf)](_0x3da8ae)){const _0x2a1935={};_0x2a1935['includeEncodedExtension']=_0x5c6941[_0x3b45d6(0xdd)],Object[_0x3b45d6(0xc8)](_0x50c7b7[_0x3b45d6(0xb3)],_0x2a1935);}return _0x50c7b7;}static['getConfig'](_0x514690,_0x953d79){const _0x50e42c={'AKBfu':function(_0x171365,_0x231a16){return _0x171365(_0x231a16);}},_0x2206b9={};return _0x2206b9['username']=_0x514690,_0x2206b9['password']=_0x953d79,{'auth':_0x2206b9,'headers':_0x50e42c['AKBfu'](getDefaultHeaders,![])};}static async[a130_0x563604(0xd7)](_0x3f9530,_0x4fb5bd){const _0x3990a3=a130_0x563604,_0x1c9c7a={'SMqTh':_0x3990a3(0xa3),'cYSLR':function(_0x34d3bd,_0x5888f8){return _0x34d3bd(_0x5888f8);}};logger['debug'](_0x1c9c7a['SMqTh']);const _0x3d20b5={'project_name':_0x3f9530['projectName']||'','name':_0x3f9530[_0x3990a3(0xe2)]||path[_0x3990a3(0xee)](path[_0x3990a3(0xcd)](process[_0x3990a3(0xe8)]())),'build_identifier':_0x3f9530[_0x3990a3(0xd5)],'description':_0x3f9530['buildDescription']||'','started_at':new Date()['toISOString'](),'tags':_0x1c9c7a['cYSLR'](getCustomTags,_0x3f9530),'host_info':bsSetupHelper[_0x3990a3(0x94)](),'ci_info':bsSetupHelper[_0x3990a3(0xf8)](),'build_run_identifier':process[_0x3990a3(0xec)][_0x3990a3(0x105)],'failed_tests_rerun':process[_0x3990a3(0xec)]['BROWSERSTACK_RERUN']||![],'linked_build_uuid':process[_0x3990a3(0xec)]['BROWSERSTACK_LINKED_BUILD_UUID']||'','version_control':await bsSetupHelper[_0x3990a3(0xae)](),'accessibility':this[_0x3990a3(0xf5)](_0x3f9530),'framework_details':testhubUtils[_0x3990a3(0x8f)](_0x3f9530,_0x4fb5bd),'product_map':testhubUtils['getProductMapForBuildStartCall'](_0x3f9530),'browserstackAutomation':bsSetupHelper[_0x3990a3(0xbc)](),'grouping_identifier':process[_0x3990a3(0xec)][_0x3990a3(0xa9)],'test_orchestration':testhubUtils[_0x3990a3(0x106)](_0x3f9530)};if(bsSetupHelper[_0x3990a3(0x111)]()['central_scanner']||bsSetupHelper['getCentralUser']()[_0x3990a3(0x10d)]){const _0x2132a7={};_0x2132a7[_0x3990a3(0xd9)]=process[_0x3990a3(0xec)]['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x2132a7[_0x3990a3(0xdf)]=process[_0x3990a3(0xec)][_0x3990a3(0xb1)],_0x3d20b5[_0x3990a3(0xba)]=_0x2132a7;}return _0x3d20b5;}static['extractDataFromResponse'](_0x44e9f3,_0x3fe454,_0x4936b6){const _0x4bc125=a130_0x563604,_0x307185={'PvbkY':function(_0x256527){return _0x256527();},'dvfSm':function(_0x51ebb0,_0x45a0f3){return _0x51ebb0&&_0x45a0f3;},'uHaPI':_0x4bc125(0x10c),'wOIkE':_0x4bc125(0x10f)},_0x53debf={};if(_0x307185[_0x4bc125(0x88)](isTestObservabilitySession)){const [_0x3be586,_0x24e188,_0x4b6e54]=testhubUtils[_0x4bc125(0xa4)](_0x3fe454[_0x4bc125(0xf7)],_0x4936b6[_0x4bc125(0xb5)]);if(_0x307185[_0x4bc125(0xd2)](_0x3be586,_0x24e188)){const _0x44a69f={};_0x44a69f['jwt']=_0x3be586,_0x44a69f[_0x4bc125(0xbe)]=_0x24e188,_0x44a69f['allowScreenshot']=_0x4b6e54,_0x53debf[testHubConstants['OBSERVABILITY']]=_0x44a69f,process[_0x4bc125(0xec)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x307185[_0x4bc125(0xd6)];}else _0x53debf[testHubConstants[_0x4bc125(0xab)]]={},process[_0x4bc125(0xec)][_0x4bc125(0xd1)]=_0x307185[_0x4bc125(0x9c)];}else process[_0x4bc125(0xec)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0x307185[_0x4bc125(0x9c)];const [_0x32bdc7,_0x33b643,_0x109612]=testhubUtils[_0x4bc125(0xca)](_0x3fe454[_0x4bc125(0xf7)]);if(_0x307185[_0x4bc125(0xd2)](_0x32bdc7,_0x33b643)){const _0x1066a8={};_0x1066a8['authToken']=_0x32bdc7,_0x1066a8[_0x4bc125(0xbe)]=_0x33b643,_0x1066a8['scannerProcessingTimeout']=_0x109612,_0x53debf[testHubConstants[_0x4bc125(0xed)]]=_0x1066a8,process[_0x4bc125(0xec)][_0x4bc125(0xce)]=_0x307185['uHaPI'];}else _0x53debf[testHubConstants[_0x4bc125(0xed)]]={},process[_0x4bc125(0xec)]['BROWSERSTACK_ACCESSIBILITY']=_0x307185['wOIkE'];return testhubUtils[_0x4bc125(0xbb)](_0x3fe454[_0x4bc125(0xf7)]),logger[_0x4bc125(0xa6)]('Testhub\x20started\x20with\x20id:\x20'+process[_0x4bc125(0xec)][_0x4bc125(0x98)]),_0x53debf;}static async[a130_0x563604(0x104)](_0x21d31b){const _0x442186=a130_0x563604,_0x207189={'eBMEd':function(_0x3bd35f,_0x3b74f5){return _0x3bd35f===_0x3b74f5;},'WLdwu':_0x442186(0x10f),'WpLjm':function(_0x278c6a,_0x251af4){return _0x278c6a===_0x251af4;},'VibrB':'null','zNodF':_0x442186(0x85),'LMLss':'error','kmEiz':_0x442186(0x96),'SUXig':'finished_metadata','JxDFr':'user_killed','FTAnk':function(_0x4a97db){return _0x4a97db();},'hkMPz':function(_0x5298d8,_0x59eeda,_0x110d02,_0x4c0a36,_0x49686c,_0x20b9a9){return _0x5298d8(_0x59eeda,_0x110d02,_0x4c0a36,_0x49686c,_0x20b9a9);},'HPoUH':_0x442186(0x110),'RNQXE':_0x442186(0x10a),'XUSXV':_0x442186(0xef)};await PerformanceTester['measureWrapper'](PerformanceEvents[_0x442186(0x112)],async()=>{const _0x3deac5=_0x442186;if(_0x207189[_0x3deac5(0xfe)](process[_0x3deac5(0xec)]['BS_TESTOPS_BUILD_COMPLETED'],_0x207189[_0x3deac5(0xd4)])||TestHubHandler['buildStopSent']||bsSetupHelper[_0x3deac5(0x84)](process[_0x3deac5(0xec)][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_JWT']]))return;TestHubHandler['buildStopSent']=!![];if(BrowserstackCLI[_0x3deac5(0xcc)]()['isRunning']())return;await this['processTraceZips'](),await RequestQueueHandler['getInstance']()['uploadPending'](),await SessionHandler[_0x3deac5(0xea)]();if(_0x207189[_0x3deac5(0xde)](process[_0x3deac5(0xec)][testHubConstants[_0x3deac5(0x89)][_0x3deac5(0xbd)]],_0x207189[_0x3deac5(0x86)])||_0x207189[_0x3deac5(0xde)](process[_0x3deac5(0xec)][testHubConstants[_0x3deac5(0x89)]['BROWSERSTACK_TESTHUB_UUID']],_0x207189['VibrB'])){logger['debug'](_0x207189[_0x3deac5(0x9d)]);const _0x23f548={};return _0x23f548[_0x3deac5(0x87)]=_0x207189[_0x3deac5(0xaf)],_0x23f548[_0x3deac5(0xb2)]=_0x207189['kmEiz'],_0x23f548;}const _0x596749={'finished_at':new Date()[_0x3deac5(0xe7)](),'finished_metadata':[]};!!_0x21d31b&&_0x596749[_0x207189[_0x3deac5(0x8e)]]['push']({'reason':_0x207189['JxDFr'],'signal':_0x21d31b,'failure_data':''});const _0x57b22f={'headers':_0x207189[_0x3deac5(0xb0)](getDefaultHeaders)};try{const _0x2f6099=await _0x207189['hkMPz'](nodeRequest,_0x207189[_0x3deac5(0xda)],'api/v1/builds/'+process['env'][testHubConstants['ENV_VAR']['BROWSERSTACK_TESTHUB_UUID']]+_0x3deac5(0xc5),_0x596749,_0x57b22f,![]);if(_0x2f6099[_0x3deac5(0xf7)]&&_0x2f6099[_0x3deac5(0xf7)][_0x3deac5(0x9a)]){const _0x530780={};_0x530780[_0x3deac5(0xb2)]=_0x2f6099[_0x3deac5(0xf7)]['error'];throw _0x530780;}else{logger[_0x3deac5(0xbf)](_0x207189['RNQXE']);const _0x243561={};return _0x243561[_0x3deac5(0x87)]=_0x207189['XUSXV'],_0x243561[_0x3deac5(0xb2)]='',_0x243561;}}catch(_0x1fbb49){_0x1fbb49[_0x3deac5(0x100)]?logger[_0x3deac5(0xbf)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+_0x1fbb49[_0x3deac5(0x100)][_0x3deac5(0x87)]+'\x20'+_0x1fbb49[_0x3deac5(0x100)]['statusText']+'\x20'+JSON[_0x3deac5(0xc2)](_0x1fbb49['response'][_0x3deac5(0xf7)])):logger['debug']('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x1fbb49['message']||_0x1fbb49));const _0x5d0403={};return _0x5d0403['status']=_0x207189[_0x3deac5(0xaf)],_0x5d0403['message']=_0x1fbb49[_0x3deac5(0xb2)]||_0x1fbb49[_0x3deac5(0x100)]?_0x1fbb49['response'][_0x3deac5(0x87)]+':'+_0x1fbb49[_0x3deac5(0x100)][_0x3deac5(0x97)]:_0x1fbb49,_0x5d0403;}})();}}module[a130_0x563604(0xf2)]=TestHubHandler;
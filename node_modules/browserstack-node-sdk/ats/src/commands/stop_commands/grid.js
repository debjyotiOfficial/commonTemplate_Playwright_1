const a21_0x56bb1a=a21_0x14ea;(function(_0x4d86ec,_0x5a313f){const _0x1dd91e=a21_0x14ea,_0x4cb271=_0x4d86ec();while(!![]){try{const _0x430883=parseInt(_0x1dd91e(0x1c5))/0x1*(parseInt(_0x1dd91e(0x1a7))/0x2)+-parseInt(_0x1dd91e(0x1d5))/0x3+parseInt(_0x1dd91e(0x1ec))/0x4+parseInt(_0x1dd91e(0x1cf))/0x5*(-parseInt(_0x1dd91e(0x1a8))/0x6)+-parseInt(_0x1dd91e(0x1dd))/0x7+-parseInt(_0x1dd91e(0x1b4))/0x8*(parseInt(_0x1dd91e(0x1ca))/0x9)+-parseInt(_0x1dd91e(0x1e3))/0xa*(-parseInt(_0x1dd91e(0x1b9))/0xb);if(_0x430883===_0x5a313f)break;else _0x4cb271['push'](_0x4cb271['shift']());}catch(_0x4cc873){_0x4cb271['push'](_0x4cb271['shift']());}}}(a21_0x45b6,0x31218));function a21_0x14ea(_0x178f18,_0x5eb77a){const _0x45b666=a21_0x45b6();return a21_0x14ea=function(_0x14ea78,_0x2e0e11){_0x14ea78=_0x14ea78-0x1a7;let _0x385cc9=_0x45b666[_0x14ea78];return _0x385cc9;},a21_0x14ea(_0x178f18,_0x5eb77a);}const fs=require('fs'),ws=require('ws'),ReconnectingWebSocket=require(a21_0x56bb1a(0x1dc)),{global_registry,HELP_HEADER_MESSAGE,HELP_FOOTER_MESSAGE,WS_ENDPOINT,messageTypes}=require(a21_0x56bb1a(0x1e2)),{logger}=require(a21_0x56bb1a(0x1b3)),{getCredentialsPath,getGridDetails}=require(a21_0x56bb1a(0x1d4)),{scaleDownHubDeployment}=require('../../utils/gridComponents'),{sendInstrumentationEvent}=require(a21_0x56bb1a(0x1f3)),webSocketUtils=require(a21_0x56bb1a(0x1e6)),{createK8sClient}=require('../../utils/createk8sClient'),{getCloudProviderObject}=require(a21_0x56bb1a(0x1d9));function a21_0x45b6(){const _0x169b5d=['ERROR','unauthorised','1293748nFhjqg','debug','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Response\x20from\x20server:\x20','Adding\x20Websocket\x20listeners','NiSxG','clusterName','stringify','../../utils/instrumentationUtils','Please\x20provide\x20ID\x20of\x20the\x20grid\x20to\x20stop','bstackAccesskey','skipTlsCertVerify','skip-tls-cert-verify','message','stop','statusCode','1256KNdCUr','183462kIFlap','epilogue','password','init-not-called','grid-id','options','addListeners','usage','mocNv','<UsernamePlaceholder>','Grid\x20stoppped.','../../config/logger','8uBxpfa','GcUDP','description','help','boolean','91883bPvfhX','Failed\x20to\x20fetch\x20grid\x20details\x20from\x20the\x20server.\x20Unauthorized\x20request!','snuWW','grid','username','exit','command','JyEon','cloudProvider','clusterRegion','bstackUsername','name','103tfbOTM','existsSync','Credentials\x20not\x20found!\x20Ensure\x20init\x20command\x20is\x20run\x20before\x20running\x20this\x20command.','EYYZp','NbOjp','2775015YLaLWr','stop-grid-called','mLTJd','VNovp','NaaAW','55nzTMzu','readFileSync','gridId','default','replace','../../utils/utilityMethods','608208iNwdwZ','parse','lvHwm','XZwiB','../../cloudproviders/utils','kRoKX','Pass\x20the\x20ID\x20of\x20the\x20running\x20Automation\x20grid\x20you\x20want\x20to\x20stop.','reconnecting-websocket','463218XHBFYT','Browserstack','GlSwa','type','IKMhz','../../config/constants','870erArAq','KYnlZ','pCXcu','../../utils/webSocketUtils','info','error','WebSocket'];a21_0x45b6=function(){return _0x169b5d;};return a21_0x45b6();}exports[a21_0x56bb1a(0x1bf)]=a21_0x56bb1a(0x1bc),exports['desc']='Stop\x20a\x20running\x20Automation\x20grid.',exports['builder']=function(_0x17d5ac){const _0x4a3b65=a21_0x56bb1a,_0x5d160e={};_0x5d160e['XZwiB']=_0x4a3b65(0x1db),_0x5d160e['snuWW']='string',_0x5d160e[_0x4a3b65(0x1ce)]='Skip\x20insecure\x20cert\x20verification.',_0x5d160e['KRfhS']=_0x4a3b65(0x1b8),_0x5d160e[_0x4a3b65(0x1b5)]=_0x4a3b65(0x1b7);const _0x3cc94c=_0x5d160e,_0x526de4={};_0x526de4[_0x4a3b65(0x1b6)]=_0x3cc94c[_0x4a3b65(0x1d8)],_0x526de4['type']=_0x3cc94c[_0x4a3b65(0x1bb)];const _0x1dd640={};_0x1dd640[_0x4a3b65(0x1b6)]=_0x3cc94c['NaaAW'],_0x1dd640[_0x4a3b65(0x1e0)]=_0x3cc94c['KRfhS'],_0x1dd640[_0x4a3b65(0x1d2)]=![];const _0x469e5e={};return _0x469e5e[_0x4a3b65(0x1ac)]=_0x526de4,_0x469e5e[_0x4a3b65(0x1f7)]=_0x1dd640,_0x17d5ac[_0x4a3b65(0x1af)](HELP_HEADER_MESSAGE[_0x4a3b65(0x1f9)])[_0x4a3b65(0x1a9)](HELP_FOOTER_MESSAGE)[_0x4a3b65(0x1ad)](_0x469e5e)[_0x4a3b65(0x1b7)](_0x3cc94c['GcUDP'])['argv'];},exports['handler']=async function(_0x21f4cc){const _0x9c0c92=a21_0x56bb1a,_0x55fdcf={'NbOjp':_0x9c0c92(0x1f4),'NiSxG':function(_0x5ac338){return _0x5ac338();},'pCXcu':_0x9c0c92(0x1c7),'EYYZp':function(_0x243aaf,_0x466a35,_0x4fd60f,_0x926740,_0x2a49ee,_0xfc202c,_0x28dc19){return _0x243aaf(_0x466a35,_0x4fd60f,_0x926740,_0x2a49ee,_0xfc202c,_0x28dc19);},'VNovp':_0x9c0c92(0x1cb),'mLTJd':_0x9c0c92(0x1ab),'uBaQZ':function(_0x76a343){return _0x76a343();},'lvHwm':_0x9c0c92(0x1b1),'mocNv':'<PasswordPlaceholder>','vAhgQ':_0x9c0c92(0x1ef),'QXomK':function(_0x34684c,_0x399756,_0x3033bb,_0x4213e9){return _0x34684c(_0x399756,_0x3033bb,_0x4213e9);},'GlSwa':function(_0x4885d7,_0x5946e0,_0x10c0c6){return _0x4885d7(_0x5946e0,_0x10c0c6);},'uKlhW':_0x9c0c92(0x1b2),'kRqAV':function(_0x4311ac,_0x82246e){return _0x4311ac===_0x82246e;},'KYnlZ':_0x9c0c92(0x1ba),'IKMhz':function(_0x192f5f,_0x455394,_0x1f072a,_0x36a4d1,_0x18eea8,_0x34280c,_0x4b4763){return _0x192f5f(_0x455394,_0x1f072a,_0x36a4d1,_0x18eea8,_0x34280c,_0x4b4763);},'qeaHn':_0x9c0c92(0x1eb),'oaxnn':function(_0x530a1b,_0x5b9b53){return _0x530a1b===_0x5b9b53;},'DyuWn':'invalid-grid-id','JyEon':function(_0x872b32,_0x38ce7e,_0x6f2b56,_0x489529,_0x506a3f,_0x565d1b,_0x5d8dcc){return _0x872b32(_0x38ce7e,_0x6f2b56,_0x489529,_0x506a3f,_0x565d1b,_0x5d8dcc);},'kRoKX':'server-error'};let _0xf07858;try{!_0x21f4cc['gridId']&&(logger[_0x9c0c92(0x1e8)](_0x55fdcf[_0x9c0c92(0x1c9)]),process['exit'](0x1));!fs[_0x9c0c92(0x1c6)](_0x55fdcf[_0x9c0c92(0x1f0)](getCredentialsPath))&&(logger['error'](_0x55fdcf[_0x9c0c92(0x1e5)]),await _0x55fdcf[_0x9c0c92(0x1c8)](sendInstrumentationEvent,_0x21f4cc,_0x55fdcf[_0x9c0c92(0x1cd)],messageTypes[_0x9c0c92(0x1ea)],_0x55fdcf[_0x9c0c92(0x1cc)],null,_0x21f4cc),process['exit'](0x1));logger[_0x9c0c92(0x1e7)]('Stopping\x20grid\x20'+_0x21f4cc[_0x9c0c92(0x1d1)]),await _0x55fdcf['EYYZp'](sendInstrumentationEvent,_0x21f4cc,_0x55fdcf[_0x9c0c92(0x1cd)],messageTypes['INFO'],null,null,_0x21f4cc);const _0x45023f=JSON[_0x9c0c92(0x1d6)](fs[_0x9c0c92(0x1d0)](_0x55fdcf['uBaQZ'](getCredentialsPath)));global_registry[_0x9c0c92(0x1c3)]=_0x45023f[_0x9c0c92(0x1de)][_0x9c0c92(0x1bd)],global_registry[_0x9c0c92(0x1f5)]=_0x45023f[_0x9c0c92(0x1de)][_0x9c0c92(0x1aa)];const _0x506c2c=WS_ENDPOINT[_0x9c0c92(0x1d3)](_0x55fdcf[_0x9c0c92(0x1d7)],_0x45023f[_0x9c0c92(0x1de)][_0x9c0c92(0x1bd)])[_0x9c0c92(0x1d3)](_0x55fdcf[_0x9c0c92(0x1b0)],_0x45023f[_0x9c0c92(0x1de)][_0x9c0c92(0x1aa)]),_0x3efcf4={};_0x3efcf4[_0x9c0c92(0x1e9)]=ws,_0x3efcf4['connectionTimeout']=0x36ee80,_0xf07858=new ReconnectingWebSocket(_0x506c2c,[],_0x3efcf4),logger[_0x9c0c92(0x1ed)](_0x55fdcf['vAhgQ']),webSocketUtils[_0x9c0c92(0x1ae)](_0xf07858,_0x21f4cc['user'],_0x21f4cc[_0x9c0c92(0x1aa)]);const [_0x50e71b,_0x2d7716]=await _0x55fdcf['QXomK'](getGridDetails,_0x45023f['Browserstack'][_0x9c0c92(0x1bd)],_0x45023f['Browserstack']['password'],_0x21f4cc['gridId']);if(_0x2d7716){const _0x4d750f=_0x2d7716[_0x9c0c92(0x1e7)];global_registry[_0x9c0c92(0x1c1)]=_0x4d750f[_0x9c0c92(0x1c1)],global_registry[_0x9c0c92(0x1c2)]=_0x4d750f['region'],global_registry[_0x9c0c92(0x1f1)]=_0x4d750f['clusterName'];const _0x7d6d97=await _0x55fdcf[_0x9c0c92(0x1c8)](getCloudProviderObject,_0x4d750f[_0x9c0c92(0x1c1)],_0x4d750f[_0x9c0c92(0x1f1)],_0x4d750f['name'],_0xf07858,webSocketUtils,_0x21f4cc),[_0x32fde6,_0x491da0,_0x211253,_0x566ee6,_0x376b3c,_0x31777a]=await _0x55fdcf[_0x9c0c92(0x1df)](createK8sClient,_0x7d6d97,_0x21f4cc[_0x9c0c92(0x1f6)]);await _0x55fdcf[_0x9c0c92(0x1df)](scaleDownHubDeployment,_0x491da0,_0x4d750f[_0x9c0c92(0x1c4)]),logger[_0x9c0c92(0x1e7)](_0x55fdcf['uKlhW']),process[_0x9c0c92(0x1be)](0x0);}_0x55fdcf['kRqAV'](_0x50e71b[_0x9c0c92(0x1fa)],0x191)&&(logger[_0x9c0c92(0x1e8)](_0x55fdcf[_0x9c0c92(0x1e4)]),await _0x55fdcf[_0x9c0c92(0x1e1)](sendInstrumentationEvent,_0x21f4cc,_0x55fdcf[_0x9c0c92(0x1cd)],messageTypes['ERROR'],_0x55fdcf['qeaHn'],null,_0x21f4cc),process[_0x9c0c92(0x1be)](0x1)),_0x55fdcf['oaxnn'](_0x50e71b[_0x9c0c92(0x1fa)],0x190)&&(logger['error'](JSON[_0x9c0c92(0x1d6)](_0x50e71b['body'])[_0x9c0c92(0x1f8)]),await _0x55fdcf[_0x9c0c92(0x1c8)](sendInstrumentationEvent,_0x21f4cc,_0x55fdcf['VNovp'],messageTypes[_0x9c0c92(0x1ea)],_0x55fdcf['DyuWn'],null,_0x21f4cc),process[_0x9c0c92(0x1be)](0x1)),logger['error'](_0x9c0c92(0x1ee)+JSON[_0x9c0c92(0x1f2)](_0x50e71b)),await _0x55fdcf[_0x9c0c92(0x1c0)](sendInstrumentationEvent,_0x21f4cc,_0x55fdcf['VNovp'],messageTypes[_0x9c0c92(0x1ea)],_0x55fdcf[_0x9c0c92(0x1da)],_0x50e71b,_0x21f4cc),process[_0x9c0c92(0x1be)](0x1);}catch(_0xc31cb8){const _0x489564='Unable\x20to\x20stop\x20the\x20Grid!\x20Error:\x20'+_0xc31cb8+'\x20\x0a'+JSON[_0x9c0c92(0x1f2)](_0xc31cb8['stack'])+'\x20';logger[_0x9c0c92(0x1e8)](_0x489564),process[_0x9c0c92(0x1be)](0x1);}};